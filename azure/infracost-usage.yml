# You can use this file to define resource usage estimates for Infracost to use when calculating
# the cost of usage-based resource, such as AWS S3 or Lambda.
# `infracost breakdown --usage-file infracost-usage.yml [other flags]`
# See https://infracost.io/usage-file/ for docs
version: 0.1

# AI RESEARCH PROJECT - $250K Monthly Budget
# High-volume AI/ML workload usage patterns for Azure
# Updated to reflect VNet networking, NSGs, Azure Firewall, Key Vault, and DDoS Protection

# The following usage values apply to each resource of the given type, which is useful when you want to define defaults.
resource_type_default_usage:
  azurerm_linux_function_app:
    monthly_executions: 20000000
    execution_duration_ms: 350
    memory_mb: 1024

  # A100 GPU VMs - ND series (20 instances)
  azurerm_linux_virtual_machine.ml_gpu_cluster_a100[*]:
    operating_system: linux
    monthly_hrs: 650 # ~21.5 hours/day for intensive research

  # NC A100 VMs (30 instances)
  azurerm_linux_virtual_machine.ml_gpu_cluster_nc[*]:
    operating_system: linux
    monthly_hrs: 600 # ~20 hours/day

# Resource-specific usage
resource_usage:
  # Azure Firewall for centralized egress filtering
  azurerm_firewall.ai_research_firewall:
    monthly_data_processed_gb: 200000 # 200 TB data processed

  # DDoS Protection Standard
  azurerm_network_ddos_protection_plan.ai_research_ddos:
    # DDoS Protection has fixed monthly cost

  # Key Vault for secrets and encryption keys
  azurerm_key_vault.ai_research_kv:
    monthly_standard_operations: 10000000 # 10M operations
    monthly_advanced_operations: 1000000 # 1M HSM operations

  # Network Security Groups - data transfer costs
  azurerm_network_security_group.ml_training_nsg:
    monthly_rule_processing_gb: 100000 # 100 TB processed

  azurerm_network_security_group.ml_inference_nsg:
    monthly_rule_processing_gb: 50000 # 50 TB processed

  azurerm_network_security_group.data_nsg:
    monthly_rule_processing_gb: 80000 # 80 TB processed

  # Network Interfaces for GPU VMs
  azurerm_network_interface.my_linux_vm_nic:
    monthly_data_transfer_gb: 5000

  azurerm_network_interface.ml_gpu_vm_nic:
    monthly_data_transfer_gb: 10000

  # Azure Machine Learning Workspace
  azurerm_machine_learning_workspace.ml_workspace:
    monthly_training_hours: 15000 # Extensive training hours

  # Original GPU VM
  azurerm_linux_virtual_machine.ml_gpu_vm:
    operating_system: linux
    monthly_hrs: 600

  # AML GPU Compute Cluster (scaled)
  azurerm_machine_learning_compute_cluster.aml_gpu_cluster:
    average_nodes: 35 # Average between min (10) and max (50)
    monthly_hrs: 700 # High utilization for research

  # AML CPU Compute Cluster
  azurerm_machine_learning_compute_cluster.aml_cpu_cluster:
    average_nodes: 60 # Average between min (20) and max (100)
    monthly_hrs: 650

  # AKS with VNet integration and network policies
  azurerm_kubernetes_cluster.ml_aks:
    nodes: 2
    monthly_hrs: 730
    monthly_cluster_management_gb: 5000

  # Original GPU node pool
  azurerm_kubernetes_cluster_node_pool.ml_gpu_nodes:
    nodes: 2
    monthly_hrs: 600

  # Research AKS cluster (scaled)
  azurerm_kubernetes_cluster.ml_aks_research:
    nodes: 5
    monthly_hrs: 730

  # Large GPU node pool for research AKS
  azurerm_kubernetes_cluster_node_pool.ml_aks_gpu_large:
    nodes: 25
    monthly_hrs: 730 # Full uptime for inference

  # Cognitive Services
  azurerm_cognitive_account.cognitive_services:
    monthly_api_calls: 100000000 # 100M API calls

  # ML Storage with VNet integration and encryption
  azurerm_storage_account.ml_storage:
    storage_gb: 10000 # 10 TB
    monthly_tier_1_requests: 20000000
    monthly_tier_2_requests: 100000000
    monthly_data_transfer_gb: 20000

  # Premium Storage for research
  azurerm_storage_account.ml_premium_storage:
    storage_gb: 100000 # 100 TB premium storage
    monthly_tier_1_requests: 100000000
    monthly_tier_2_requests: 500000000
    monthly_data_transfer_gb: 50000

  # NetApp Files Ultra-performance storage
  azurerm_netapp_pool.ml_netapp_pool:
    storage_tb: 100
    monthly_throughput_mbps: 128000 # Ultra tier throughput

  # Container Instances
  azurerm_container_group.ml_inference:
    monthly_hrs: 730
    cpu_cores: 2
    memory_gb: 4

  # Original Databricks
  azurerm_databricks_workspace.ml_databricks:
    monthly_dbu_hours: 5000

  # Research Databricks (scaled)
  azurerm_databricks_workspace.ml_databricks_research:
    monthly_dbu_hours: 50000 # Extensive analytics workloads

  # Synapse Analytics
  azurerm_synapse_workspace.ml_synapse:
    monthly_sql_pool_hours: 730
    monthly_data_processed_tb: 500

  # Synapse Spark Pool
  azurerm_synapse_spark_pool.ml_spark_pool:
    average_nodes: 60 # Average usage
    monthly_hrs: 650
    monthly_data_processed_tb: 300

  # Container Registry
  azurerm_container_registry.ml_acr:
    storage_gb: 5000 # 5 TB of container images
    monthly_build_minutes: 50000
    monthly_webhook_calls: 1000000

  # Managed Disks for staging (20 disks)
  azurerm_managed_disk.ml_data_disks[*]:
    storage_gb: 4096
    monthly_disk_operations: 10000000

  # Log Analytics
  azurerm_log_analytics_workspace.ml_monitoring:
    monthly_data_ingested_gb: 10000 # 10 TB of logs
    monthly_data_retention_gb: 50000
